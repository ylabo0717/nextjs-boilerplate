#!/bin/sh

echo "ğŸ” Running pre-push checks..."

# Secret scan
echo "ğŸ“ Checking for secrets..."
gitleaks detect --config .gitleaks.toml --log-level=error

if [ $? -ne 0 ]; then
  echo "âŒ Secrets detected! Push aborted."
  echo "ğŸ’¡ Run 'gitleaks detect --verbose' for details"
  exit 1
fi

echo "âœ… No secrets detected"

# ESLint with strict TSDoc validation
echo "ğŸ“š Running ESLint with strict documentation checks..."
pnpm lint:pre-push

if [ $? -ne 0 ]; then
  echo "âŒ ESLint validation failed! Push aborted."
  echo "ğŸ’¡ Fix ESLint errors and add TSDoc comments to all exported items"
  echo "ğŸ’¡ Run 'pnpm lint:pre-push' locally to see errors"
  exit 1
fi

echo "âœ… ESLint validation passed"

# TypeDoc validation
echo "ğŸ“– Validating documentation completeness..."
pnpm docs:check

if [ $? -ne 0 ]; then
  echo "âŒ Documentation build failed! Push aborted."
  echo "ğŸ’¡ Run 'pnpm docs' to see detailed errors"
  exit 1
fi

echo "âœ… Documentation validation passed"