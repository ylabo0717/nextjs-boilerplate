# E2E テストコメントレビュー

対象: `tests/e2e/*.spec.ts`

## health.spec.ts

- 整合性: 概ね一致。/api/health 実装（`src/app/api/health/route.ts`）のスキーマに沿った検証を行っている。
- 指摘1（要対応）: Content-Type を `toBe('application/json')` で厳密一致している箇所が複数あり。将来的に `application/json; charset=utf-8` などが付与される場合に脆くなるため、`toContain('application/json')` に変更する方がコメントの「適切な JSON コンテンツタイプ」意図と整合。
- 指摘2（任意）: HEAD リクエストのテストは Next.js 既定で 405 の可能性に言及しており、コメント・実装の整合性は取れている。現状の注釈は適切。
- 良い点: 並行アクセス、パフォーマンス、各種 UA/ヘッダーなど運用観点の網羅がされており、@remarks で意義が明確。

## metrics.spec.ts

- 整合性: `/api/metrics` 実装（`src/app/api/metrics/route.ts`）と一致。JSON でメタ情報を返す設計と HEAD でのヘルスチェックを正しく検証。
- 指摘: Content-Type は `toContain('application/json')` の方が将来的に安全（health と同様）。
- 良い点: 併走、キャッシュヘッダー、応答時間など監視連携の観点が適切にドキュメント化されている。

## home.spec.ts

- 整合性: 表示確認・メタタグ・外部リンク・レスポンシブ・キーボード操作の観点は妥当。
- 指摘1（要対応）: タイトルと description が固定文字列。将来的な文言変更に脆弱。SSOT（tests/constants など）へ寄せるか、アプリの metadata 由来値に合わせる旨をコメントに明記することを推奨。
- 指摘2（任意）: ドキュメントリンクのテストは存在しない場合の分岐があり、テストの意図（"存在すれば属性も妥当"）はコメントに追補するとより明確。

## navigation.spec.ts

- 整合性: 404 ハンドリング・外部リンク属性はコメントと一致。
- 指摘1（要対応）: 「スクロール位置をナビゲーションで維持」の説明に対し、実装はスクロールのみでナビゲーションを行っていない。以下のいずれかを推奨。
  - コメントを実装に合わせて「スクロールが機能することの検証」に修正
  - テストを意図に合わせ、A→B→戻る等のナビゲーションを挟み、スクロール位置検証を追加
- 良い点: セキュリティ属性（rel="noopener noreferrer"）の明示と @example は◎。

## accessibility.spec.ts

- 整合性: Axe による自動検出、見出し階層、ARIA、キーボード操作、コントラスト、lang、スキップリンクと広範囲をカバー。コメントの意図と一致。
- 指摘: 重大な不整合なし。コントラスト・lang のテストはプロダクト側変更で落ちやすいので、コメントに「運用上の注意（デザイン変更時の見直しが必要）」を一言追記すると親切。

## 総括（E2E）

- 重要修正候補: health/metrics の Content-Type 断定→包含、navigation の意図と実装の不一致、home の固定文言。
- コメントの質は全般に高く、意図・背景も明確。小さな運用リスクへの言及を加えるとさらに良くなります。
