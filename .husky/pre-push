#!/bin/sh

echo "🔍 Running pre-push checks..."

# Secret scan
echo "📝 Checking for secrets..."
gitleaks detect --config .gitleaks.toml --log-level=error

if [ $? -ne 0 ]; then
  echo "❌ Secrets detected! Push aborted."
  echo "💡 Run 'gitleaks detect --verbose' for details"
  exit 1
fi

echo "✅ No secrets detected"

# ESLint with strict TSDoc validation
echo "📚 Running ESLint with strict documentation checks..."
pnpm lint:pre-push

if [ $? -ne 0 ]; then
  echo "❌ ESLint validation failed! Push aborted."
  echo "💡 Fix ESLint errors and add TSDoc comments to all exported items"
  echo "💡 Run 'pnpm lint:pre-push' locally to see errors"
  exit 1
fi

echo "✅ ESLint validation passed"

# TypeDoc validation
echo "📖 Validating documentation completeness..."
pnpm docs:check

if [ $? -ne 0 ]; then
  echo "❌ Documentation build failed! Push aborted."
  echo "💡 Run 'pnpm docs' to see detailed errors"
  exit 1
fi

echo "✅ Documentation validation passed"