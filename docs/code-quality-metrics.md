# Code Quality Metrics Documentation

## Overview

This project implements comprehensive code quality analysis using ESLint plugins for TypeScript/JavaScript static analysis. The system measures complexity, maintainability, duplication, and other quality metrics without relying on external paid services.

## Available Metrics

### 1. **Complexity Metrics** üß©

- **Cyclomatic Complexity**: Measures the number of independent paths through code
- **Cognitive Complexity**: Measures how difficult code is to understand
- **Maximum Complexity**: Highest complexity value in the codebase
- **Average Complexity**: Mean complexity across all files

### 2. **Maintainability Metrics** üèóÔ∏è

- **Maintainability Index**: Score from 0-100 (higher is better)
- **Rating**: Letter grade (A-F) based on maintainability
- **Technical Debt**: Estimated time to fix issues

### 3. **Code Quality Indicators** üéØ

- **TypeScript Errors**: Type safety violations
- **ESLint Errors**: Code standard violations
- **ESLint Warnings**: Non-critical issues
- **Test Coverage**: Percentage of code covered by tests

### 4. **File Metrics** üìÅ

- **Lines of Code**: Average and maximum per file
- **Large Files**: Files exceeding 300 lines
- **File Count**: Total files analyzed

### 5. **Duplication Metrics** üîÑ

- **Duplicate Strings**: Repeated string literals
- **Duplicate Functions**: Similar code blocks
- **Duplication Percentage**: Estimated duplicate code ratio

## Tools and Plugins

### ESLint Plugins

1. **eslint-plugin-sonarjs**
   - Detects code smells and complexity issues
   - Rules for cognitive complexity, duplicate code, and more
   - Configuration in `eslint.config.mjs`

2. **eslint-plugin-jsdoc**
   - Ensures proper documentation
   - Validates JSDoc comments
   - Checks parameter and return descriptions

3. **eslint-plugin-unicorn**
   - Modern JavaScript best practices
   - Performance optimizations
   - Consistent code patterns

## Usage

### Local Analysis

```bash
# Run complete code quality analysis
pnpm quality:analyze

# Generate unified quality report
pnpm quality:report

# Run both analysis and report
pnpm quality:full
```

### Available Scripts

| Command                | Description                          |
| ---------------------- | ------------------------------------ |
| `pnpm quality:analyze` | Run ESLint-based complexity analysis |
| `pnpm quality:report`  | Generate unified quality report      |
| `pnpm quality:full`    | Run analysis and generate report     |
| `pnpm quality:check`   | Basic quality gate checks            |
| `pnpm lint`            | Run ESLint with all plugins          |

## Quality Thresholds

### Recommended Limits

| Metric                | Good  | Warning | Error |
| --------------------- | ----- | ------- | ----- |
| Cyclomatic Complexity | < 5   | 5-10    | > 10  |
| Cognitive Complexity  | < 10  | 10-15   | > 15  |
| Maintainability Index | > 85  | 70-85   | < 70  |
| File Length           | < 200 | 200-300 | > 300 |
| Function Length       | < 20  | 20-50   | > 50  |
| Duplicate Strings     | 0     | 1-3     | > 3   |

### Where thresholds are defined

- Central definition: `scripts/constants/quality-metrics.ts`
  - `COMPLEXITY_LEVELS`: A‚ÄìF with human‚Äëreadable descriptions (e.g., "Dangerous - Must be refactored")
  - `COMPLEXITY_THRESHOLDS`: Warning and maximum thresholds (individual/average)
  - `ESLINTCC_RANKS`, `ESLINT_COMPLEXITY_RULES`: ESLint settings used by analysis scripts

Notes:

- The table "Recommended Limits" shows suggested values. The enforced Quality Gate thresholds are driven by `COMPLEXITY_THRESHOLDS`.
- Analysis scripts run ESLint with `ESLINT_COMPLEXITY_RULES`, independently from the repo‚Äëwide ESLint config.

### ESLint Configuration

Current settings (can be adjusted in `eslint.config.mjs`):

```javascript
'sonarjs/cognitive-complexity': ['warn', 15],  // Cognitive complexity limit
'sonarjs/no-duplicate-string': ['warn', { threshold: 3 }],    // Max duplicate strings
'sonarjs/no-identical-functions': 'error',     // No duplicate functions
```

In-script ESLint settings (used by analysis scripts):

- Source: `scripts/constants/quality-metrics.ts`
  - `scripts/code-quality-analysis.ts` consumes `ESLINT_COMPLEXITY_RULES` and `ESLINTCC_RANKS`.
  - Lets you tune complexity rules for analysis without changing the global ESLint config.

How to update thresholds:

1. Edit `scripts/constants/complexity-thresholds.ts` (e.g., change individual MAX from 20 ‚Üí 18)
1. Verify locally:

```bash
pnpm quality:analyze && pnpm quality:report
pnpm quality:check
```

1. CI Quality Gate evaluation uses `scripts/quality-gate.ts` and reads from `COMPLEXITY_THRESHOLDS`.

## Reports

### 1. JSON Metrics

- **Location**: `metrics/code-quality-latest.json`
- **Contents**:
  - Raw metrics data
  - Detailed file analysis
  - Timestamp and history

### 2. Unified Quality Report

- **Location**: `metrics/unified-report.md`
- **Contents**:
  - Combined metrics from all sources
  - Health score (0-100)
  - Actionable recommendations
  - Markdown format for easy reading

## GitHub Actions Integration

### Automated Analysis

The `code-quality.yml` workflow runs:

- **Weekly**: Every Monday at 00:00 UTC
- **On PR**: When code changes are pushed
- **Manual**: Via workflow dispatch

Features:

- Automatic PR comments with quality report
- Issue creation for critical problems (health score < 60)
- Artifact storage of reports
- GitHub summary generation

### PR Comment Example

```markdown
üìä Unified Quality Report

Overall Health Score: 85/100 ‚úÖ

Performance Metrics:

- Build Time: 2m 30s ‚úÖ
- Bundle Size: 3.2 MB ‚úÖ

Code Quality:

- TypeScript Errors: 0 ‚úÖ
- Maintainability: 82.5 (B) ‚úÖ
- Avg Complexity: 4.3 ‚úÖ

Recommendations:

- ‚úÖ Code quality is excellent!
```

## Interpreting Results

### Health Score

The overall health score (0-100) indicates:

- **80-100**: Excellent - High quality, well-maintained code
- **60-79**: Good - Acceptable quality with some improvements needed
- **40-59**: Fair - Significant improvements recommended
- **0-39**: Poor - Immediate attention required

### Complexity Guidelines

**Cyclomatic Complexity**:

- **1-4**: Simple, easy to test
- **5-7**: Moderate, still manageable
- **8-10**: Complex, consider refactoring
- **>10**: Too complex, should be refactored

**Cognitive Complexity**:

- **1-5**: Easy to understand
- **6-10**: Requires some attention
- **11-15**: Difficult to understand
- **>15**: Very difficult, needs refactoring

### Maintainability Index

- **100-90**: Highly maintainable (A)
- **89-80**: Moderately maintainable (B)
- **79-70**: Somewhat maintainable (C)
- **69-60**: Difficult to maintain (D)
- **<60**: Very difficult to maintain (F)

## Best Practices

### Improving Complexity

1. **Extract Functions**: Break large functions into smaller ones
2. **Early Returns**: Use guard clauses to reduce nesting
3. **Simplify Conditionals**: Use lookup tables or polymorphism
4. **Remove Duplication**: Extract common code to shared functions

### Improving Maintainability

1. **Add Documentation**: Write clear JSDoc comments
2. **Use Descriptive Names**: Make code self-documenting
3. **Keep Files Small**: Split large modules
4. **Follow Patterns**: Use consistent coding patterns

### Example Refactoring

**Before** (High Complexity):

```javascript
function processData(data) {
  if (data) {
    if (data.type === 'A') {
      if (data.value > 100) {
        // process A high
      } else {
        // process A low
      }
    } else if (data.type === 'B') {
      // process B
    }
  }
}
```

**After** (Low Complexity):

```javascript
function processData(data) {
  if (!data) return;

  const processors = {
    A: processTypeA,
    B: processTypeB,
  };

  const processor = processors[data.type];
  if (processor) processor(data);
}

function processTypeA(data) {
  return data.value > 100 ? processHighValue(data) : processLowValue(data);
}
```

## Troubleshooting

### Common Issues

1. **ESLint complexity warnings**
   - Review flagged files for refactoring opportunities
   - Adjust thresholds if too strict for your project
   - Use `// eslint-disable-next-line` for justified exceptions

2. **Low maintainability scores**
   - Add JSDoc comments
   - Reduce file size
   - Simplify complex logic

3. **High duplication percentage**
   - Extract common code to utility functions
   - Use configuration objects for repeated patterns
   - Consider creating reusable components

## Future Improvements

- [ ] Integration with VS Code for real-time feedback
- [ ] Historical trend charts
- [ ] Team-specific quality goals
- [ ] Automated refactoring suggestions
- [ ] Performance impact analysis
- [ ] Advanced TypeScript-specific metrics

## Health ScoreÔºàÁßëÂ≠¶ÁöÑÊ†πÊã†„Å®ÁÆóÂá∫Ôºâ

„Åì„ÅÆ„É™„Éù„Ç∏„Éà„É™„ÅÆ„Éò„É´„Çπ„Çπ„Ç≥„Ç¢Ôºà0‚Äì100Ôºâ„ÅØ„ÄÅ‰ª•‰∏ã„ÅÆÂéüÂâá„Å®‰∏ÄÊ¨°ÊÉÖÂ†±„Å´Âü∫„Å•„ÅÑ„Å¶Ë®≠Ë®à„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

### 1. Ë®≠Ë®àÂéüÂâáÔºàÊ†πÊã†Ôºâ

- ÂìÅË≥™„É¢„Éá„É´: ISO/IEC 25010„ÅÆÂìÅË≥™ÁâπÊÄßÔºàÁâπ„Å´„ÄåMaintainability„Äç„ÄåPerformance efficiency„ÄçÔºâ„ÇíÊé°Áî®„Åó„ÄÅË©ï‰æ°Ë¶ñÁÇπ„Å®Èáç„Åø‰ªò„Åë„Å´ÂèçÊò†„ÄÇ
- Quality Gate„ÅÆÊÑèÂë≥Ë´ñ: SonarQube„ÅÆQuality Gate„ÅØÊù°‰ª∂„ÅÆÊ∫Ä„Åü„Åô/Ê∫Ä„Åü„Åï„Å™„ÅÑ„Çí‰∫åÂÄ§„ÅßÂà§ÂÆö„Åó„ÄÅ„Çπ„Ç≥„Ç¢„ÅßÁõ∏ÊÆ∫„Åó„Å™„ÅÑÈÅãÁî®„ÅåÊ®ôÊ∫ñ„ÄÇ
- Á∂≠ÊåÅÊÄßÊåáÊ®ô: Microsoft„ÅÆMaintainability IndexÔºà0‚Äì100Ôºâ„ÇíÁ¨¨‰∏ÄÁ¥öÊåáÊ®ô„Å®„Åó„Å¶Êé°Áî®ÂèØËÉΩ„Å™Â†¥Âêà„ÅØÁõ¥Êé•Ê¥ªÁî®„ÄÇ
- Ë§áÈõëÂ∫¶√ó„ÉÜ„Çπ„Éà„ÅÆÁõ∏‰∫í‰ΩúÁî®: CRAP„É°„Éà„É™„ÇØ„Çπ„ÅÆÁü•Ë¶ãÔºàÈ´òË§áÈõëÂ∫¶√ó‰Ωé„Ç´„Éê„É¨„ÉÉ„Ç∏„ÅØÂ§âÊõ¥„É™„Çπ„ÇØ„ÇíÂ¢óÂ§ßÔºâ„ÇíÈñ¢Êï∞ÂΩ¢„ÇÑÂãæÈÖç„Å´ÂèçÊò†„ÄÇ

ÂèÇËÄÉ:

- ISO/IEC 25010ÔºàÂìÅË≥™ÁâπÊÄßÔºâ
- SonarQube Quality GateÔºàÊé®Â•®Êù°‰ª∂: Coverage‚â•80%„ÄÅDuplication‚â§3%„ÄÅÈáçÂ§ßIssue 0Ôºâ
- Microsoft Maintainability Index „ÅÆÂºè„Å®ÈñæÂÄ§Â∏Ø
- CRAP: Change Risk Analysis and Predictions

### 2. ‰∫åÂ±§Âûã„É¢„Éá„É´

1. Quality GateÔºà„Éê„Ç§„Éä„É™Âà§ÂÆöÔºâ

- ÈáçÂ§ß‰∏çÂÖ∑ÂêàÂêåÁ≠â: TypeScript Errors>0 „Åæ„Åü„ÅØ ESLint Errors>0 ‚Üí Fail
- Coverage<80% ‚Üí Fail
- Duplication>3% ‚Üí Fail

2. Ê≠£Ë¶èÂåñ„Çπ„Ç≥„Ç¢„ÅÆÂä†ÈáçÂíåÔºà0‚Äì100Ôºâ

- ÂêÑ„É°„Éà„É™„ÇØ„Çπ„Çí0‚Äì100„Å´Ê≠£Ë¶èÂåñ„Åó„ÄÅÂä†ÈáçÂπ≥Âùá„ÅßÈõÜÁ¥Ñ„ÄÇ

### 3. Ê≠£Ë¶èÂåñ„ÅÆ‰æãÔºà0‚Äì100Ôºâ

- Maintainability Index: „Åù„ÅÆ„Åæ„Åæ0‚Äì100ÔºàÂèñÂæó‰∏çÂèØÊôÇ„ÅØË§áÈõëÂ∫¶„Å´Èáç„ÅøÂÜçÈÖçÂàÜÔºâ
- Âπ≥ÂùáË§áÈõëÂ∫¶ÔºàCC avgÔºâ: 5‚Üí100, 10‚Üí80, 15‚Üí60, 20‚Üí40, 30‚Üí20, >30‚Üí0 „ÅÆÂå∫ÂàÜÁ∑öÂΩ¢
- ÊúÄÂ§ßË§áÈõëÂ∫¶ÔºàCC maxÔºâ: 20Ë∂Ö„ÇíÊÆµÈöéÁöÑ„Å´Ê∏õÁÇπÔºà‰∏äÈôê„É™„Çπ„ÇØÊäëÂà∂Ôºâ
- ÈáçË§áÁéáÔºà%Ôºâ: 0‚Üí100, 3‚Üí95, 10‚Üí60, 20‚Üí30, ‚â•30‚Üí0 „ÅÆÂå∫ÂàÜÁ∑öÂΩ¢
- „Ç´„Éê„É¨„ÉÉ„Ç∏Ôºà%Ôºâ: 80%„ÅßÂº∑„ÅÑÂãæÈÖçÔºà50‚Üí0, 80‚Üí80, 90‚Üí90, 100‚Üí100Ôºâ
- TypeScript Errors: 0‚Üí100„ÄÅ>0„ÅØÈùûÁ∑öÂΩ¢„ÅßÊÄ•Ê∏õÔºà‰ø°Âè∑ÁöÑÔºâ
- ESLint Errors: 0‚Üí100„ÄÅ>0„ÅßÁ©è„ÇÑ„Åã„Å´Ê∏õÁÇπ
- ESLint Warnings: 10‰ª∂Ë∂ÖÈÅéÂàÜ„ÅÆ„ÅøÁ∑©„ÇÑ„Åã„Å´Ê∏õÁÇπ
- Build Time: ÁõÆÊ®ôÔºà‰æã: ‚â§2ÂàÜÔºâ‚Üí100„ÄÅÊúÄÂ§ßÔºà5ÂàÜÔºâ‚Üí0 „ÅÆÁ∑öÂΩ¢
- Bundle Size: ÁõÆÊ®ôÔºà5MBÔºâ‚Üí100„ÄÅÊúÄÂ§ßÔºà100MBÔºâ‚Üí0 „ÅÆÁ∑öÂΩ¢

Ê≥®: ÂÖ∑‰ΩìÁöÑ„Åó„Åç„ÅÑÂÄ§„ÅØ `scripts/constants/quality-metrics.ts` „Å´ÈõÜÁ¥Ñ„ÄÇ

### 4. Èáç„ÅøÔºàÂêàË®à=1.0Ôºâ„ÅÆ‰æã

- Maintainability„Éñ„É≠„ÉÉ„ÇØ 0.55ÔºàMI 0.25„ÄÅCC avg 0.15„ÄÅCC max 0.05„ÄÅDup 0.10Ôºâ
- „ÉÜ„Çπ„ÉàÂìÅË≥™ 0.15ÔºàCoverageÔºâ
- ÈùôÁöÑ‰∏çÂÖ∑Âêà 0.10ÔºàTS Errors 0.06„ÄÅESLint Errors 0.04Ôºâ
- „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ 0.20ÔºàBuild 0.10„ÄÅBundle 0.10Ôºâ

MIÊú™ÂèñÂæóÊôÇ„ÅØ„ÄÅ„Åù„ÅÆÈáç„Åø„ÇíCC avg„Å∏ÂÜçÈÖçÂàÜ„Åó„Åæ„Åô„ÄÇ

### 5. Gate FailÊôÇ„ÅÆ„Çπ„Ç≥„Ç¢Âá¶ÁêÜÔºàÊé®Â•®: „Ç≠„É£„ÉÉ„ÉóÊñπÂºèÔºâ

- Âà§ÂÆö„ÅåFail„ÅÆ„Å®„Åç„ÄÅhealthScore„ÅÆ‰∏äÈôê„Çí59„Å´„Ç≠„É£„ÉÉ„Éó„Åó„Åæ„ÅôÔºà‰æã: min(raw, 59)Ôºâ„ÄÇ
- Gate„ÅÆ„Éê„Ç§„Éä„É™ÊÄßÔºàÊ®ôÊ∫ñÈÅãÁî®Ôºâ„ÇíÂÆà„Çä„Å§„Å§„ÄÅraw„Çπ„Ç≥„Ç¢„ÅØÂà•ÈÄî‰øùÂ≠ò/ÂèØË¶ñÂåñ„Åó„Å¶„Éà„É¨„É≥„ÉâÂàÜÊûê„Å´Âà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ

### 6. Â∞ÜÊù•„ÅÆ„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥

- ÂàÜ‰ΩçÁÇπÊ≠£Ë¶èÂåñ: „É™„ÉùÂÜÖ„ÅÆÂ±•Ê≠¥ÂàÜÂ∏ÉÔºàp10‚Äìp90Ôºâ„Å´Âü∫„Å•„ÅÑ„Å¶„Çπ„Ç≥„Ç¢„É¨„É≥„Ç∏„ÇíÂãïÁöÑË™øÊï¥
- ÁõÆÁöÑÈÅ©Âêà: ÈöúÂÆ≥/„É¨„Éì„É•„Éº‰∏çÂêàÊ†ºÁéá/ÊäïÂÖ•Â∑•Êï∞„Å®„ÅÆÁõ∏Èñ¢„Å´Âü∫„Å•„ÅèÈáç„ÅøÂÜçÂ≠¶ÁøíÔºàMCDA/ÂõûÂ∏∞Ôºâ
- Êñ∞Ë¶è„Ç≥„Éº„ÉâÈáçË¶ñ: Êñ∞Ë¶è„Ç≥„Éº„Éâ„É°„Éà„É™„ÇØ„ÇπÂèñÂæóÂæå„ÅØSonarÂêåÊßò„ÅÆ„ÄåÊñ∞Ë¶è„Ç≥„Éº„ÉâÂü∫Ê∫ñ„Äç„Å∏ÁßªË°å

### 7. Âá∫ÂÖ∏

- ISO/IEC 25010ÔºàÂìÅË≥™„É¢„Éá„É´Ôºâ: [https://iso25000.com/index.php/en/iso-25000-standards/iso-25010](https://iso25000.com/index.php/en/iso-25000-standards/iso-25010)
- SonarQube Quality Gates: [https://docs.sonarsource.com/sonarqube/latest/user-guide/quality-gates/](https://docs.sonarsource.com/sonarqube/latest/user-guide/quality-gates/)
- Maintainability IndexÔºàMicrosoft DocsÔºâ: [https://learn.microsoft.com/en-us/visualstudio/code-quality/code-metrics-maintainability-index-range-and-meaning](https://learn.microsoft.com/en-us/visualstudio/code-quality/code-metrics-maintainability-index-range-and-meaning)
- Code metrics valuesÔºàMicrosoft DocsÔºâ: [https://learn.microsoft.com/en-us/visualstudio/code-quality/code-metrics-values](https://learn.microsoft.com/en-us/visualstudio/code-quality/code-metrics-values)
- CRAP metricÔºàArtimaÔºâ: [http://www.artima.com/weblogs/viewpost.jsp?thread=210575](http://www.artima.com/weblogs/viewpost.jsp?thread=210575)
